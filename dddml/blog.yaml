aggregates:
  Article:
    metadata:
      Preprocessors: ["MOVE_CRUD_IT"]
    id:
      name: Id
      type: UID

    properties:
      Title:
        type: String
        length: 200
      Body:
        type: String
        length: 2000
      Owner:
        type: address
      Tags:
        itemType: String
        defaultLogic:
          Move:
            "std::vector::empty()"
      Comments:
        itemType: Comment

    entities:
      Comment:
        metadata:
          Preprocessors: ["MOVE_CRUD_IT"]
        id:
          name: CommentSeqId
          type: u64
        properties:
          Commenter:
            type: String
            length: 100
          Body:
            type: String
            length: 500
          Owner:
            type: address
    methods:
      Update:
        verificationLogic:
          Move:
            "assert!(sui::tx_context::sender(ctx) == article::owner(article), 111);"
      UpdateComment:
        verificationLogic:
          Move:
            "assert!(sui::tx_context::sender(ctx) == comment::owner(comment), 111);"
      RemoveComment:
        verificationLogic:
          Move:
            "assert!(sui::tx_context::sender(ctx) == comment::owner(comment), 111);"
      AddComment:
        event:
          name: CommentAdded
          properties:
            Owner:
              type: address
        parameters:
          CommentSeqId:
            type: u64
          Commenter:
            type: String
            length: 100
          Body:
            type: String
            length: 500

      UpdateTags:
        event:
          name: ArticleTagsUpdated
        parameters:
          Tags:
            itemReferenceType: Tag
            size:
              min: 1
              max: 3

  Tag:
    metadata:
      Preprocessors: ["MOVE_CRUD_IT"]
    immutable: true
    id:
      name: Name
      type: String
      generator:
        class: assigned
        tableName: TagNameTable
    methods:
      Create:
        event:
          isObjectFrozen: true
